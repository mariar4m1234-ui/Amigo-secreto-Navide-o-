<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <title>Amigo Secreto</title>
    <style>
        * {
            box-sizing: border-box;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
            background: #f5f5f5;
            color: #333;
        }

        .container {
            max-width: 600px;
            margin: 40px auto;
            padding: 20px 25px 30px;
            background: #ffffff;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.08);
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #2c3e50;
        }

        .subtitle {
            text-align: center;
            font-size: 0.95rem;
            color: #555;
            margin-bottom: 20px;
        }

        .instructions {
            background: #f0f4ff;
            border-left: 4px solid #3f51b5;
            padding: 12px 14px;
            border-radius: 8px;
            font-size: 0.95rem;
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
        }

        select {
            width: 100%;
            padding: 10px;
            border-radius: 8px;
            border: 1px solid #ccc;
            font-size: 1rem;
            margin-bottom: 16px;
        }

        .buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            justify-content: center;
            margin-bottom: 16px;
        }

        button {
            padding: 10px 18px;
            border-radius: 999px;
            border: none;
            font-size: 0.95rem;
            cursor: pointer;
            transition: transform 0.1s ease, box-shadow 0.1s ease, opacity 0.2s ease;
        }

        button:active {
            transform: translateY(1px);
            box-shadow: none;
        }

        .btn-primary {
            background: #3f51b5;
            color: #ffffff;
            box-shadow: 0 3px 8px rgba(63, 81, 181, 0.4);
        }

        .btn-secondary {
            background: #e0e0e0;
            color: #333;
            box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
        }

        .btn-primary:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            box-shadow: none;
        }

        .result-card {
            display: none;
            margin-top: 10px;
            padding: 18px 16px;
            background: #fff8e1;
            border-radius: 12px;
            border: 1px solid #ffecb3;
            text-align: center;
        }

        .result-title {
            font-size: 0.95rem;
            text-transform: uppercase;
            letter-spacing: 0.05em;
            color: #f57c00;
            margin-bottom: 6px;
        }

        .result-name {
            font-size: 1.4rem;
            font-weight: 700;
            color: #e65100;
        }

        .message {
            margin-top: 10px;
            font-size: 0.9rem;
            text-align: center;
            color: #d32f2f;
        }

        footer {
            margin-top: 20px;
            text-align: center;
            font-size: 0.8rem;
            color: #888;
        }

        @media (max-width: 480px) {
            .container {
                margin: 20px 12px;
                padding: 16px;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <h1>Amigo Secreto üéÅ</h1>
    <p class="subtitle">Juego de Amigo Secreto para 8 personas</p>

    <div class="instructions">
        <strong>Instrucciones:</strong><br>
        Cada persona puede entrar desde su propio celular, elegir su nombre y pulsar
        <em>‚ÄúVer mi amigo secreto‚Äù</em> para ver a qui√©n le dar√° el regalo.<br>
        El sistema siempre usa el mismo sorteo para todos (mismo resultado para cada nombre).
    </div>

    <div>
        <label for="participantSelect">Selecciona tu nombre:</label>
        <select id="participantSelect">
            <option value="">-- Elige tu nombre --</option>
        </select>
    </div>

    <div class="buttons">
        <button id="showButton" class="btn-primary">Ver mi amigo secreto</button>
        <button id="hideButton" class="btn-secondary">Ocultar resultado</button>
    </div>

    <div id="resultCard" class="result-card">
        <div class="result-title">Tu amigo secreto es:</div>
        <div id="resultName" class="result-name"></div>
    </div>

    <div id="message" class="message"></div>

    <footer>
        El sorteo es siempre el mismo para todos mientras no cambies la semilla ni la lista de nombres.
    </footer>
</div>

<script>
    // ==============================
    // CONFIGURACI√ìN DEL JUEGO
    // ==============================

    // Lista de participantes (puedes editarla):
    const participantes = [
        "Esteban",
        "Juana",
        "Mar√≠a Jos√©",
        "Laura",
        "Daniel",
        "Karol",
        "Angela",
        "Mabel"
    ];

    // Semilla fija para que el sorteo sea SIEMPRE el mismo en todos los dispositivos.
    // Si quieres un sorteo nuevo (por ejemplo, el pr√≥ximo a√±o), cambia este n√∫mero.
    const SEED = 202512;

    // Objeto donde se guardar√° la asignaci√≥n final (derangement):
    // { "Esteban": "Juana", "Juana": "Daniel", ... }
    let asignaciones = {};

    // ==============================
    // GENERADOR PSEUDOALEATORIO CON SEMILLA
    // ==============================
    /**
     * Generador pseudoaleatorio tipo mulberry32.
     * Con la misma semilla, siempre produce la misma secuencia de n√∫meros.
     */
    function mulberry32(seed) {
        let t = seed >>> 0;
        return function() {
            t += 0x6D2B79F5;
            let r = t;
            r = Math.imul(r ^ (r >>> 15), r | 1);
            r ^= r + Math.imul(r ^ (r >>> 7), r | 61);
            r = (r ^ (r >>> 14)) >>> 0;
            return r / 4294967296;
        };
    }

    /**
     * Mezcla determin√≠sticamente un array usando el generador con semilla.
     * Esto hace un shuffle tipo Fisher-Yates, pero usando rng() en vez de Math.random().
     */
    function mezclarDeterministico(array, rng) {
        const copia = array.slice(); // no modificamos el original
        for (let i = copia.length - 1; i > 0; i--) {
            const j = Math.floor(rng() * (i + 1));
            [copia[i], copia[j]] = [copia[j], copia[i]];
        }
        return copia;
    }

    /**
     * Genera una asignaci√≥n v√°lida de Amigo Secreto (derangement) de forma determin√≠stica:
     * - Nadie se asigna a s√≠ mismo.
     * - Todos tienen exactamente un amigo secreto.
     *
     * Comentario importante:
     * Usamos un generador con semilla fija (SEED). Eso hace que,
     * aunque la p√°gina se abra en distintos celulares y momentos,
     * el algoritmo recorra EXACTAMENTE los mismos pasos y produzca
     * la misma asignaci√≥n final para todos.
     */
    function generarAsignacionesDeterministicas(participantes, rng) {
        const n = participantes.length;
        let permutado;
        let esValido = false;

        // Repetimos mientras haya alguien auto-asignado.
        // Como rng es determin√≠stico, todos los navegadores har√°n
        // el mismo n√∫mero de intentos y obtendr√°n el mismo resultado final.
        while (!esValido) {
            permutado = mezclarDeterministico(participantes, rng);
            esValido = true;
            for (let i = 0; i < n; i++) {
                if (participantes[i] === permutado[i]) {
                    esValido = false;
                    break;
                }
            }
        }

        const resultado = {};
        for (let i = 0; i < n; i++) {
            const persona = participantes[i];
            const amigoSecreto = permutado[i];
            resultado[persona] = amigoSecreto;
        }
        return resultado;
    }

    /**
     * Llena el <select> con la lista de participantes.
     */
    function inicializarSelect() {
        const select = document.getElementById("participantSelect");
        participantes.forEach(nombre => {
            const option = document.createElement("option");
            option.value = nombre;
            option.textContent = nombre;
            select.appendChild(option);
        });
    }

    /**
     * Muestra el resultado en la tarjeta.
     * @param {string} nombre
     */
    function mostrarResultado(nombre) {
        const resultado = asignaciones[nombre];
        const resultCard = document.getElementById("resultCard");
        const resultName = document.getElementById("resultName");

        resultName.textContent = resultado || "";
        resultCard.style.display = resultado ? "block" : "none";
    }

    /**
     * Oculta la tarjeta y el mensaje.
     */
    function ocultarResultado() {
        const resultCard = document.getElementById("resultCard");
        const resultName = document.getElementById("resultName");
        const message = document.getElementById("message");
        const select = document.getElementById("participantSelect");

        resultCard.style.display = "none";
        resultName.textContent = "";
        message.textContent = "";
        select.value = "";
    }

    document.addEventListener("DOMContentLoaded", function () {
        // Creamos un generador pseudoaleatorio con la semilla fija:
        const rng = mulberry32(SEED);

        // 1. Generamos la misma asignaci√≥n determin√≠stica para todos.
        asignaciones = generarAsignacionesDeterministicas(participantes, rng);

        // 2. Llenamos el select
        inicializarSelect();

        // 3. Configuramos botones
        const showButton = document.getElementById("showButton");
        const hideButton = document.getElementById("hideButton");
        const message = document.getElementById("message");

        showButton.addEventListener("click", function () {
            const select = document.getElementById("participantSelect");
            const nombre = select.value;

            if (!nombre) {
                message.textContent = "Por favor, selecciona tu nombre antes de continuar.";
                ocultarResultado();
                return;
            }

            message.textContent = "";
            mostrarResultado(nombre);
        });

        hideButton.addEventListener("click", function () {
            ocultarResultado();
        });
    });
</script>
</body>
</html>
